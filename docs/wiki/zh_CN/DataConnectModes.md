# Data Connect Modes - 数据连接模式

## 综述

在 FTP 协议中，数据连接模式主要分为 **主动（Active）** 和 **被动（Passive）** 两种基本类型，而根据客户端和服务器的角色不同，
可以进一步细分为四种模式，在下文中将一一介绍。

## 本地主动模式

- 名称（别称）：本地主动模式（传统主动模式 / PORT 模式）
- 枚举值：`0`。
- 常量代码：`FtpConfig.Builder.DATA_CONNECTION_MODE_ACTIVE_LOCAL`。
- 工作机制：
  - 客户端通过 `PORT` 命令将自己的IP地址和端口告知服务器。
  - 服务器主动连接到客户端指定的端口以建立数据通道。
  - 每次传输前客户端都会发送 `PORT` 命令，确保服务器使用新的连接。
- 使用场景：
  - 传统的 FTP 主动模式，使用于客户端能够开放端口且无防火墙限制的环境（如内网环境）。
- 注意事项：
  - 可能因客户端的防火墙 / NAT 导致连接失败（服务器无法反向连接客户端）。

## 远程主动模式

- 名称（别称）：远程主动模式（反向主动模式）
- 枚举值：`1`。
- 常量代码：`FtpConfig.Builder.DATA_CONNECTION_MODE_ACTIVE_REMOTE`。
- 工作机制：
  - 客户端向当前连接的服务器发送 `PORT` 命令，指定另一台服务器（Remote Server）的IP和端口。
  - 当前服务器主动连接到指定的远程服务器端口，建立数据通道。
- 使用场景：
  - 服务器到服务器传输（如 FXP 协议）。
  - 需明确远程服务器的地址和端口。
- 注意事项
  - 远程服务器需允许当前服务器连接其指定端口。

## 本地被动模式

- 名称（别称）：本地被动模式（传统被动模式 / PASV 模式）
- 枚举值：`2`。
- 常量代码：`FtpConfig.Builder.DATA_CONNECTION_MODE_PASSIVE_LOCALE`。
- 工作机制：
  - 客户端发送 `PASV`（或 `EPSV`，扩展被动模式）命令。
  - 服务器返回其监听的IP和端口，客户端主动连接到该端口进行数据传输。
- 使用场景：
  - 适用于客户端位于防火墙 / NAT 后的场景（如现代互联网环境）。
  - 常规的客户端到服务器的文件传输（如下载、上传）。
- 注意事项：
  - 服务器需配置允许被动模式并开放端口范围。。

## 远程被动模式

- 名称（别称）：远程被动模式（反向被动模式）
- 枚举值：`3`。
- 常量代码：`FtpConfig.Builder.DATA_CONNECTION_MODE_PASSIVE_REMOTE`。
- 工作机制：
  - 客户端向当前服务器发送 `PASV` 命令，服务器进入被动模式并返回监听的IP和端口。
  - 另一台服务器需主动连接到该端口以完成数据传输。
- 使用场景：
  - 服务器到服务器传输，且当前服务器需作为被动方。
  - 适用于协调两台服务器间的数据连接（如反向 FXP 传输）。
- 注意事项：
  - 当前服务器的防火墙需允许外部连接其被动模式端口。

## 模式对比总结

| 模式   | 发起连接方  | 命令     | 典型场景           | 关键区别             |
|:-----|:-------|:-------|:---------------|:-----------------|
| 本地主动 | 服务器    | `PORT` | 传统客户端传输        | 服务器主动连接客户端       |
| 本地被动 | 客户端    | `PASV` | 现代客户端传输（防火墙后）  | 客户端连接服务器的被动端口    |
| 远程主动 | 当前服务器  | `PORT` | 服务器间传输（FXP 主动） | 当前服务器连接另一台服务器    |
| 远程被动 | 另一台服务器 | `PASV` | 服务器间传输（FXP 被动） | 当前服务器监听，另一台服务器连接 |
